\chapter{Case Studies}
\label{chapter-case-studies}

\emph{``Things to avoid: User studies. Real code. Talking to practitioners. All you'll learn is that your assumptions were all wrong, your approach won't work, and the problem is much hairier than expected. Don't let reality come between you and your publication. (15/18)"}~\citep{zeller2021_tweet_the_devils_guide_to_incremental_research_15_18}. As Bertrand Meyer observes, empirical studies are vital yet studies into processes - how practitioners work - is particularly challenging: \emph{``The difficulties are formidable."}~\citep{meyer2018_towards_empirical_answers_to_important_engineering_questions}. For each of these case studies, people and organisations needed to be convinced to share business critical and sensitive engineering data - on how and when their software fails in the real world. The help and support of all the case study participants is particularly appreciated, and similarly to the people who considered but were not able to help in the research - thank you for listening.

Case studies may provide insights that might not be achieved using other methods~\citep{rowley2002_using_case_studies_in_research}. This research includes a combination of case studies to provide as many insights as practical. The roles of the researcher include: active participant, coach, observer, and interviewer. Two of the case studies include a hackathon and demonstrate how they can use used fruitfully to address reliability issues in the respective mobile apps. The projects range in scope from small teams, such as Moodspace and LocalHalo, to larger groups -- Kiwix, Moonpig, and Catrobat -- to large-scale international businesses where 50+ developers support a single mobile app and platform combination. The projects also include opensource codebases and working practices, through closed source self-contained apps, to apps with millions of users as components in larger enterprise wide systems and services. 

%\textbf{MUST-DO} integrate one or more of the tables from the \href{section-case-studies-red-thread}{case-studies' red-thread} section.
%\input{empirical-studies/empirical-studies-red-thread}

The participants in the case studies include: teams who rely on analytics others gather and provide, those who minimally incorporate libraries into their apps, those who write code to actively use the analytics libraries, and even touch on organisations who roll-their-own end-to-end analytics service.

Two providers of analytics tools are also included. The first - Google - emerged when issues were discovered with the Google Play Console, used by every Android developer who releases apps in the Google Play Store, and the second - Iteratively - when they contacted me about my research and agreed to provide their insights and perspective on their approach to improve the use and value of usage analytics. Vignettes and insights from other analytics providers are also included. 

Virtually all the case studies cover the Android platform and ecosystem, which is probably the largest composite ecosystem globally (at least for the duration of this research). Some also extend to other platforms and ecosystems, and some examples have been included in this research as they help illustrate the concepts, approach, challenges, and value of the concept of improving application quality using mobile analytics also apply to those ecosystems and related technologies.



\clearpage
\section{Overview of Case Studies}
\label{section-overview-of-case-studies}
\begin{figure}
    \centering
    \includegraphics[width=15cm]{images/my/six-perspectives-2x3-matrix-25-oct-2021abc.jpeg}
    \caption{Six Perspectives (repeated for the case studies)}
    \label{fig:six-perspectives-in-case-studies}
\end{figure}


The case studies apply the six perspectives (illustrated in Figure~\ref{fig:six-perspectives-in-case-studies}) that were introduced to help answer the main research question by using three distinct approaches of applying Mobile Analytics to Android apps
~\footnote{Android apps were selected to enable the use of Google Play Console reports and analytics, including Android Vitals; nonetheless one of organisations studied chose to also include analytics in their iOS app, so this will also be covered briefly.}. Each study contributes to at least one of these six perspectives. In practice they all contribute to several and may contribute to most of them. 

\textbf{Challenge: how to structure the studies in the thesis} As each study contributes to a range of the perspectives, I find it hard to decide on a way to report on the various studies clearly so the reader can maintain focus and clarity in terms of the readability of the research\footnote{
\textbf{Marian's suggested gameplan} 
I need to provide for each study:
Context and orientation; then drive from the [6] perspectives.
A suggested order: Status Quo slice, then what happens if we interfere?
}.

\begin{enumerate}
    \item The first approach is to learn what app developers do in terms of using mobile analytics for their apps. The material collected includes a mix of direct interactions, conversations, together with investigating various artefacts. These artefacts stem from two sources: 1) mobile analytics reports, and 2) the development team (\emph{e.g.} source control, bug reporting tools). Some developers provided direct access, others provided offline snapshots.
    \item The second approach is direct engagement with the project teams to facilitate more in-depth research. Two of the projects are opensourced, the rest are proprietary, commercial mission-critical apps. Each of these projects had their own needs in terms of their use of mobile analytics.  % Can we interfere / affect their behaviours
    \item The third approach focuses on the source code of various Android apps to investigate how the app developers incorporate analytics into their respective apps in terms of the types of information they recorded using the dominant in-app mobile analytics library: Firebase. The code provides a dispassionate perspective. % What do they do in terms of their code. 
\end{enumerate}

Several small experiments complemented the case studies, for instance to evaluate what is reported using both platform and in-app analytics. 
The research led to collaborations with two providers of mobile analytics, Google and Iteratively (since acquired and integrated into Amplitude); and provided insight into a wider range of mobile analytics tools.


\subsection{The rest of this chapter}

This chapter first introduces the methodology and repeatability aspects of case-studies for research into mobile analytics in \secref{section-methodology-ethics-and-repeatability-of-case-studies}. This is followed with another introduction into range of known data sources used in at least one of the case studies, in \secref{section-case-studies-data-sources}. 

Section \secref{section-field-reports-case-studies} presents the app developers' perspectives. 

The direct engagement case studies start with the two opensource case studies \secref{section-kiwix-case-study} and \secref{section-catrobat-case-study}. These are followed with extracts from one or more commercial projects in \secref{section-corporate-engineering-case-studies}, to protect the confidentiality of the organisation various details have been removed. Some representative and similar, `white-labeled' examples are also used to anonymise otherwise potentially sensitive characteristics of the source of the case study; where practical these have been made available as opensource projects to facilitate exploration and reproduction.

The source code perspective is in \secref{section-research-in-logging-practices}.

Where practical the experiments incorporate small opensource projects created for the respective experiments and are described in \secref{section-mini-experiments} and \secref{section-some-examples}. 

The collaborations with providers are covered in \secref{section-google-play-console-case-study} and \secref{section-iteratively-case-study}~\footnote{TODO consider whether to include the work with Appachhi.}. A summary of the various mobile analytics tools is covered in \secref{appendix-analytics-tools}

The final part of this chapter provides a summary of the various case studies \secref{section-summary-of-case-studies}. 

%%%% Marker for Julian - continue below here %%%%
\hrulefill
\clearpage
\section{Previous material follows}
\textit{The following content needs to be reevaluated and the stuff that's still relevant will be integrated earlier in this chapter.}
\begin{figure}[htbp!]
    \centering
    \includegraphics[width=10cm]{images/visual-connections-in-research.png}
    \caption{Visual Connections in my research}
    \label{fig:visual-connections-in-research}
\end{figure}

\textit{MUST-DO update this figure, it is out of date.} Figure \ref{fig:visual-connections-in-research}  aims to provide a visual overlay of the main practical elements of the research from 2018 to 2020. There are three main factors: 1) the type(s) of analytics used, 2) the development team and their apps, and 3) the progression of the case studies, as they augment what has been learned in earlier case studies.
% \akb{Why is it important to understand the timeline here - what implication does it have for understanding the research problem?}

The research started with the Kiwix~\footnote{The Kiwix project enables people to use Wikipedia and other content offline~\url{https://www.kiwix.org/en/}} set of Android apps where the app with the highest crash rate, as reported by Google's Android Vitals, was used as the experiment to see if the crash rate could be improved. By design the Kiwix apps do not include any analytics or crash reporting to minimise the digital usage footprint of these apps as they may be used in areas of the world where Wikipedia is banned, \emph{etc.} where the users may be persecuted or even imprisoned. Nonetheless, as the apps were available through Google Play (amongst many sources), the development team received ongoing reports in Google Play Console including the Android Vitals reports on various `stability' metrics as defined and applied by Google.

The Catrobat team was and is an extremely well researched and supported collection of mobile apps intended to help young people learn how to enjoy developing games visually. It was established % Removed details for the review period: "by Professor Wolfgang Slany of" 
at the TU Graz university where both undergraduate and postgraduate students actively practice software skills on the codebase. My engagement started around June 2019, and we decided jointly to pick the thornier and most complex Android app - Pocket Code - as the subject for our collaboration and research, as it had proved to have an intractable ongoing issue with the high reported crash rate and was therefore a worthy challenge for the concepts proposed in my research. We had a reference app, called Pocket Paint, which had a lower crash rate. Note: Pocket Paint was and is incorporated into Pocket Code in addition to being a standalone app.

Pocket Code already incorporated one of the most popular crash analytics library called Crashlytics. At the time, it used an older, mature version of Crashlytics branded Fabric (a business first acquired by Twitter, then by Google). I have chosen to use the term \emph{liminal}~\footnote{\url{https://www.lexico.com/en/definition/liminal}} to indicate crash reporting is something that lives in the boundary layer between the app and the operating system, or platform. Either is able to observe application crashes, and for apps where both the app and the platform capture information about crashes the two data sources can be usefully cross-referenced and compared, as my research has done.

As Pocket Code was an Android app, available in Google Play, the team also received the reports provided by Google through Google Play. These two data sources provided an interesting and rich set of research challenges. 

Relatively recently, in February 2020, the Catrobat team had to migrate their Crashlytics reporting from the Fabric service, which Google was ceasing, to Firebase, the replacement reporting service Google provided. In parallel with this migration of the reporting, the project team agreed to incorporate mobile analytics into their Android and iOS apps. They decided to use Firebase Analytics for various reasons (to be covered later in my thesis), hence the extension of the apps into app-level analytics.

The two arrows in the figure indicate an area of unplanned research: 
%
I discovered various flaws in the developer-oriented reports Google provides to app developers who make their apps available in Google Play (approximately 2.9 million apps globally). This led initially to discussions with the relevant engineering teams for Google Play and Android Vitals at Google where they confirmed various flaws. They asked for ongoing updates on my findings and requested a report which I provided. Through our interactions and discussions, I realised the merit of researching the characteristics and flaws in analytics tools, and particularly those provided by Google for Android developers. This research is ongoing and intended to continue post-PhD given the importance and relevance of the topic.

In mid-2019 several commercial Android development teams learned of my research and offered to contribute their experiences and practices of using mobile analytics in their commercial apps. These apps include app-level analytics in addition to the development teams receiving the ongoing reports Google provides automatically. The contributions of these development teams helped provide additional weight to the value and relevance of using mobile analytics to identify flaws in mobile apps and evidence of the importance developers placed on addressing quality issues gleaned through these tools.

%\yy{The practical research}{Need to complete the sentences, what is liminal? Change Kiwix/Catrobat apps to "Kiwix/Catrobat teams"? }

\begin{table}[htbp!]
    \centering
    \small
    \setlength{\tabcolsep}{4pt} %% default is 6pt
    \begin{tabular}{llrr}
      Case Study &Role of Researcher &Apps &Active Users\\
      \hline
       \href{https://play.google.com/store/apps/dev?id=9116215767541857492&hl=en_GB}{Kiwix}  &Embedded &18 &367K\\
       \href{https://play.google.com/store/apps/developer?id=Catrobat&hl=en_GB}{Catrobat} &Guide &6 &200K\\
       \href{https://play.google.com/store/apps/dev?id=7665838187257770408}{Greentech Apps} &Observed &10 &987K\\
       \href{https://play.google.com/store/apps/developer?id=Moonpig.com&hl=en_GB}{Moonpig.com} &Observed &1 &130K\\
       \href{https://play.google.com/store/apps/details?id=boundless.moodgym&hl=en_GB}{Moodspace app} &Interviewed &1 &20K\\
       \href{https://play.google.com/store/apps/details?id=com.localhalo.app&hl=en_GB}{Local Halo app} &Observed &1 &1.1K\\
       Commercial case study &Consultant &1 &1.9M\\
       Analytics tools &Various &10\textsuperscript{6} &10\textsuperscript{9} \\
    \end{tabular}
    \caption{Project teams and Commercial apps in the case studies}
    \label{tab:case_studies}
\end{table}

For the Kiwix case study, the researcher has been an intrinsic long-term member of the diffuse project team, able to work directly with the code-base and collaborate directly with the developers and ancillary members of the project team. The second phase of the case study included collaboration during a week-long hackathon, the first of two case studies that used a hackathon as part of the research. 

For the Catrobat case study, the researcher advised and assisted the project team to apply mobile analytics to their larger, older, and less reliable app: \emph{Pocket Code}. The researcher helped lead a one-day hackathon and otherwise interacted through a bug reporting tool, JIRA, discussions and using shared documents. Pocket Code also included a crash-reporting library which allowed cross-tool comparisons of reports, analytics and data. During the research, the reporting platform for the crash-reporting was migrated to a newer service which provided further insights and comparisons across and between the various mobile analytics tools.

The Greentech apps case study blends public and private sharing of their projects, they track issues in public, the codebase is private. Their active userbase is larger than the combined userbases of the Kiwix and Catrobat mobile apps. The team structure is similar to those for the Kiwix project: it is a not-for-profit foundation where donations help fund some of the development work; however many of the development team members are part-time volunteers. Their core team are in Bangladesh, distant from the Western world, and their focus is to enable native Bangla speakers to learn and study the Quran. Their priorities differ from those of most projects; the quality of their material is paramount; and they sometimes disable support for apps that have serious quality flaws in these materials. 

For the commercial app teams (Moonpig, Moodspace, and LocalHalo), the researcher corresponded with one of the development team for each of the commercial apps and received either direct access to their analytics tools (LocalHalo), or was provided with snapshots (Moonpig and Moodspace). Permission was granted by their respective organisations for their contributions to be used for research purposes.

The corporate case study has an order of magnitude more complexity than the other apps with much higher demands on the software being reliable and performant. The business and the service provided through the client apps are expected to grow massively as the product matures and the software quality improves. While they include clients for MacOS, iOS, Android, webRTC, and Windows desktop operating systems, the case study focuses on the Android client.

How developers of Android apps actually use mobile analytics for remote logging compared to how developers use local logging focuses on the perceived purpose of the logging across over 100 opensource projects on GitHub.com. And the final case study is from the perspective of a startup who are developing and researching tools and techniques to help developers improve their design, implementation and use of usage analytics tools (both web and mobile apps). 

\subsection{TODO: Structure used to describe the case studies}
TODO describe Arosha's proposed structure and introduce its applicability and purpose here.

\clearpage
\input{empirical-studies/methodology-ethics-and-repeatability-of-the-case-studies}
\input{empirical-studies/data-sources}

\input{empirical-studies/developers-experiences-of-mobile-analytics}
\input{empirical-studies/gtaf-case-study}
\clearpage

\input{empirical-studies/kiwix-team-case-study}
\clearpage

\input{empirical-studies/catrobat-case-study}
\clearpage

\input{empirical-studies/major-corporations}
\clearpage

\input{empirical-studies/logging-case-studies}
\clearpage

\input{empirical-studies/mini-experiments}
\input{empirical-studies/some-examples}
\clearpage

\input{empirical-studies/google-play-console-case-study}
\input{empirical-studies/iteratively-case-study}
\clearpage

\input{empirical-studies/summary-of-case-studies}
\clearpage