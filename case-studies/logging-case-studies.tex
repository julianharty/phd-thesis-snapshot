\section{Research in logging practices}
\label{section-research-in-logging-practices}
Logging and mobile analytics intersect with each other, particularly in terms of how they are implemented and in using them to record aspects of the runtime behaviour of software. Previous case studies in this thesis focused on the use and application of various forms of mobile analytics, this section focuses on some of the details of the implementation of logging and the use of mobile analytics to provide a form of remote logging. 

Here we cover:
\begin{itemize}
    \item analysis of logging practices via Firebase Analytics in 107 opensource Android apps,
    \item tools and utilities developed to facilitate the capture and testing of logging in Android apps,
    \item followed by a discussion the design and testing of logging pertaining to Android apps.
\end{itemize}

Logging orients to line-item details and analytics to patterns in what has been logged when the data is aggregated.

\subsection{TODO Materials to incorporate}
\textit{This subsection is to remind me of my various sources for this case study. This entire subsection needs removing once I've done so.}
\begin{itemize}
    \item My draft paper on improving logging.
    \item The MOBILESoft 2021 paper, under review currently.
    \item Various notes in `Notes' on my macbook account.
    \item Bits and pieces related to Shonan Meeting 152. The report provides a useful reminder. Note, for my hysteresis concept we can also add the adaption and application of enterprise tools e.g. using ELK stack.  
\end{itemize}

%After covering various aspects of logging in proprietary apps and codebases, this section addresses three topics with a common focus on logging and logging tools available in opensource projects. It covers two aspects, with a subsequent discussion on the design and testing of logging:

As we learn to program we also enjoy seeing the program output things to show it's doing something under our control, when we run the program we see messages being output, when we don't run it, we don't - concomitant variation in action!~\citep{mill1884system}. Listing~\ref{code:basic_example} is a representative example of the sort of program some of us would have written in BASIC, equivalent output statements exist in many programming languages. Examples to say `Hello World' are available in 28 programming languages~\citep{helloworld2017}. 

% https://www.overleaf.com/learn/latex/Code_Highlighting_with_minted
\begin{listing}
\caption{A representative first BASIC program} \label{code:basic_example}
\begin{minted}{basic}
10 cls
20 print "Hello, world!"
30 sleep
40 end
\end{minted}
Source: \href{https://en.wikibooks.org/wiki/BASIC_Programming/Beginning_BASIC/Your_First_Program}{en.wikibooks.org/wiki/BASIC\_Programming/Beginning\_BASIC/Your\_First\_Program}
\end{listing}

Programmers continue to write and use output statements to observe aspects of what a program is doing, the values of variables, and so on. This includes programmers who develop mobile apps. They can use core components in a programming language, such as a \texttt{printf\{'...'\}} statement, logging libraries, such as \texttt{Log.w\{'...'\}} from the core \mintinline{java}|Android.util.Log|
library, custom logging libraries such as timber, and proprietary libraries. They can also use Mobile Analytics libraries for logging purposes which is what led to this case study.
% https://tex.stackexchange.com/questions/45756/inline-code-and-short-verb-with-minted

Mobile platforms include an operating system that runs on the device; both Android and iOS are based on UNIX. UNIX includes three standard terminal I/O devices: \texttt{stdin}, \texttt{stdout}, and \texttt{stderr}. Of interest here are \texttt{stdout} and \texttt{stderr} which are both output devices, that output text and errors respectively. Developers can therefore use these in their programs, albeit the platform providers (Google and Apple) recommend developers use logging libraries instead. These I/O devices can be redirected the log files on the devices as various people note.

\textbf{Android} includes: comparing ways to redirect \texttt{stdout} to logcat [the standard Android log]~\citep{krysmanski2012_so_redirect-stdout-to-logcat-in-android-NDK, rcdailey2018_ndk_redirect_to_logcats}, and an elegant solution for native code is described in~\citep{tsiombikas2014_native_NDK_stdio_to_android_log}.

\textbf{iOS} includes: 

By default the output of programs are local to the computer the program runs on. This characteristic limits the ability for programmers to observe or analyse the outputs, they need to be local and see the logs as they are generated. 
%
When programs run remotely from the developer they cannot see the logs directly. Many tools exist for collecting and analysing logs from servers and systems, conversely few tools exist to obtain logs from end-user device, which include their smartphones and tablets. Nonetheless, runtime logs are still of interest to developers of mobile apps both for local debugging (generally pre-release) and for remote analysis.



\subsection{How do developers of opensource Android apps use Firebase Analytics?}
\begin{enumerate}
    \item Analysis of third-party opensource Android apps that incorporate Firebase Analytics.
    \item Tools we created to facilitate the testing and analysis of logging by Android developers.
    \item Discussion in methods to improve the effectiveness of logging and the analysis of log messages generated by apps.
\end{enumerate}

Logging is an integral part of the software development process, ranging from sometimes seemingly random print statements to using fully featured software libraries and sophisticated software systems to transfer, replicate, store and analyze log data. Logs are also important developer aids for diagnosing problems and errors, with many app developers collect crash logs for their app from end-user devices - some even ask users for permission to send crash logs when problems occur.  This use of logging is particularly important for mobile software development, where developers need to understand the difference between between effects of the runtime environment, such as poor connectivity, from behaviours of the app when handling the various runtime conditions.

When developers incorporate mobile analytics in their apps, what do they use them for? 

In earlier case studies in this thesis several commercial developers shared their practices informally. This case study complements their insights by analysing 107 opensource Android projects that use Google's Firebase Analytics (the most popular and prevalent in-app analytics tool) to answer two research questions:
\begin{enumerate}
    \item What are the characteristics of logging practices with mobile analytics?
    \item What do developers log with mobile analytics?
\end{enumerate}

This research was performed jointly with an international group of researchers, all-bar-one, met at the~\textit{\nth{152 }NII Shonan meeting~\citep{nii_shonan_workshop_152}} where a group of us agreed to investigate the use of logging in mobile applications as a follow-up activity. We wrote and submitted our first paper in October 2020 where I am the first author. The paper is currently under review. The materials are available as an opensource project at \url{https://github.com/mobileanalyticslogs/mobileanalyticslogging/}.



Early research explored ways developers of opensource Android apps use local logging, a complementary and oft used approach intended to help developers learn more about how their app behaves locally at run-time. MUST-DO provide context either here or in the related works chapter.



MUST-DO continue to write up our post-shonan paper.



\subsubsection{Tacit/default use of analytics}
50 of the 107 codebases studied ... expand with contents from the collaborative research post Shonan. Cross-link my material on tacit logging here.

\subsection{Tools to facilitate capture and testing of logging}

\begin{itemize}
    \item \href{https://github.com/ISNIT0/log-searcher}{\textbf{Log Searcher}}:
    \item \href{https://github.com/ISNIT0/logcat-filter}{\textbf{Logcat Filter}}:
    \item \href{https://github.com/ISNIT0/log-complexity-comparison}{\textbf{Log Complexity Comparison}}:
    \item \href{https://github.com/ISNIT0/AndroidLogAssert}{\textbf{Android Log Assert}}:
    \item \href{https://github.com/ISNIT0/AndroidCrashDummy}{\textbf{Android Crash Dummy}}:
\end{itemize}



\subsection{Discussion on practical aspects for the design, incorporation, and testing of logging} \label{apx:practical-aspects-for-design-and-incorporation-of-logging}
%This appendix introduces various practical aspects of incorporation of mobile analytics that are not necessary to understand the overall approach. The intention is to help those who would be actively involved in the concepts and approach described in the core thesis.
This introduces germane aspects of the design and incorporation of logging...



\subsection{Designing logging}
Unstructured logging can serve immediate needs, for instance to trace code execution or display the value of a variable at run-time. The resulting entries into a log file have limited value in terms of longer term analysis and they may also be harder to identify, filter, and lack relevant content for such analysis.

In the domain of logging both business and research consider logging design important and valuable. 

Storage and transmission of log entries. Sematext provides opensource libraries for Android~\citep{github2020_sematext_logsene_android} and iOS.

Controllable logging: Developers can optionally provide facilities to control the amount of logging that is performed by the app. The well-established K-9 Mail Android app includes optional debug logging that users can activate to help developers diagnose problems and errors~\citep{github2020_k9mail_logging_errors}. A good example of this feature being used is issue 2705 \emph{``Deleted mail from inbox is doubled in trash directory"} on their GitHub site where various users contributed logs and additional information~\citep{github2017_k9mail_issue_2705}. Out of interest, the issue took 20 months to address and multiple contributions before the development team determined the cause, according to the updates in the issue. The project team uses this facility extensively; by \nth{23} December 2020 they had 11 open and 128 closed issues that included the keyword~\href{https://github.com/k9mail/k-9/issues?utf8=\%E2\%9C\%93\&q=is\%3Aissue\%20is\%3Aopen\%20loggingerrors\%20}{loggingerrors}.
% Note: in 2017 the project has 30 open issues and 39 closed, which reference the LoggingErrors wiki page. https://github.com/k9mail/k-9/issues?utf8=%E2%9C%93&q=is%3Aissue%20is%3Aopen%20loggingerrors%20 Some issues are waiting for logging to be provided, others include the requested logcat output.

Materials to incorporate on designing logging:
\begin{itemize}
    \item Retrace from Stackify: Logging meets monitoring. Full lifecycle APM.~\url{https://stackify.com/}
    \begin{itemize}
        \item \url{https://docs.stackify.com/docs/error-and-logs} Logging Rate, Top Errors, Recent Errors, Top Error Chart, Error Rates in dev, test and production.
        \item Application Performance: Slow Pages, Performance Breakdown, Slow Query, Server Performance, Satisfaction Breakdown.~\url{https://docs.stackify.com/docs/application-performance-widgets}
        \item Monitoring and Metrics, App Score:~\href{https://docs.stackify.com/docs/app-score-widgets}{https:// docs.stackify.com/docs/app-score-widgets}.
        \item Centralized Logging: 
        \item Filters, Fields and Tags, and Querying logs:~\url{https://docs.stackify.com/docs/logs-dashboard}. Monitoring logs. 
    \end{itemize}Control Which Logs are Sent to Stackify; ~\texttt{Enrich.WithProperty};~\texttt{stackifyLogger.ForContext}~\url{https://docs.stackify.com/docs/errors-and-logs-serilog}. \emph{``Our .NET libraries automatically handle batching, compressing, queuing, throttling, and error retry logic for uploading your application logs."}\url{https://docs.stackify.com/docs/errors-and-logs-net-supported-frameworks}. \url{https://docs.stackify.com/docs/troubleshoot-errors-and-logs-net-configurations} 4 steps to troubleshooting logging to Stackify's systems. And possibly use the App Score somewhere else in the thesis?~\url{https://docs.stackify.com/docs/appscore}
\end{itemize}

Implementation choices: 

\subsection{Testing logging}
Unit testing of logging to date has not been widely available as a core capability of the logging libraries. There are several possible approaches to asserting the logging is as expected, these include recording the log output \emph{within} the software \emph{i.e.} in memory, and checking what has been written to an actual log [file]. The first approach is described in \citep{altindag2020_unit_testing_log_messages_made_easy} and made available as an opensource project called LogCaptor~\citep{log-captor-github-project}. The second approach was implemented jointly by myself and Joseph Reeve and made available as an opensource project~\citep{android_log_assert}. Both these approaches assert that what was intended to be in the log actually appears there. At the time of writing, the LogCaptor includes richer examples. Our work supports the standard Android logging API in addition to custom logging libraries. As both projects are opensourced and have permissive licenses there is the opportunity to improve either or both of them and for cross-fertilisation.

